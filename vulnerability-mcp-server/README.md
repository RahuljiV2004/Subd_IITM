# MCP Vulnerability Scanner Server

A comprehensive Model Context Protocol (MCP) server for intelligent vulnerability analysis and security scanning.

## Features

üéØ **Intelligent Vulnerability Analysis**
- Smart tool selection based on target characteristics
- Automated false positive reduction
- Risk-based prioritization of findings
- Integration with Flask backend for enhanced analysis

üõ†Ô∏è **Comprehensive Tool Suite**
- **Nmap**: Network discovery and port scanning
- **Nuclei**: Fast vulnerability scanning with community templates
- **Nikto**: Web server vulnerability assessment
- **FFUF**: Web application content discovery and fuzzing

üß† **AI-Powered Intelligence**
- Context-aware tool orchestration
- OWASP Top 10 compliance mapping
- Automated remediation recommendations
- Advanced analysis prompts and methodologies

## Installation

### Prerequisites

- Python 3.8+
- Security tools (automatically installed via scripts):
  - Nmap
  - Nuclei
  - Nikto
  - FFUF

### Setup

1. **Install Security Tools** (if not already done):
   ```powershell
   # Run the tool installation script
   .\fix_missing_tools.ps1
   ```

2. **Install Python Dependencies**:
   ```bash
   pip install -r requirements.txt
   ```

3. **Configure the Server**:
   ```bash
   # Edit configuration if needed
   cp config/config.example.py config/config.py
   ```

## Usage

### Starting the MCP Server

```bash
python -m src.server
```

### Available Tools

The server exposes the following MCP tools:

#### `vulnerability_scan`
Performs intelligent vulnerability scanning with automatic tool selection.

**Parameters:**
- `target` (required): Target URL, IP, or hostname
- `strategy` (optional): Scanning strategy (auto, quick, comprehensive, stealth)
- `risk_level` (optional): Risk tolerance (low, medium, high)
- `time_budget` (optional): Time budget in seconds

**Example:**
```json
{
  "target": "https://example.com",
  "strategy": "comprehensive",
  "risk_level": "medium",
  "time_budget": 600
}
```

#### `run_nmap`
Network discovery and port scanning.

**Parameters:**
- `target` (required): Target IP, hostname, or network range
- `ports` (optional): Port specification
- `scan_type` (optional): Type of scan to perform
- `service_detection` (optional): Enable service detection
- `os_detection` (optional): Enable OS detection

#### `run_nuclei`
Fast vulnerability scanning with templates.

**Parameters:**
- `target` (required): Target URL or hostname
- `templates` (optional): Template categories to use
- `severity` (optional): Severity levels to include
- `concurrency` (optional): Number of concurrent requests

#### `run_nikto`
Web server vulnerability scanning.

**Parameters:**
- `target` (required): Target hostname or IP
- `port` (optional): Port to scan
- `ssl` (optional): Use HTTPS
- `timeout` (optional): Request timeout

#### `run_ffuf`
Web application content discovery.

**Parameters:**
- `target` (required): Target URL with FUZZ keyword
- `wordlist` (optional): Wordlist to use
- `extensions` (optional): File extensions to check
- `threads` (optional): Number of concurrent threads

### Available Resources

#### `methodology_guide`
Comprehensive vulnerability assessment methodology and best practices.

#### `owasp_mapping`
OWASP Top 10 compliance mapping and analysis framework.

#### `tool_comparison`
Detailed comparison of available security tools and their capabilities.

## Configuration

### Environment Variables

- `FLASK_BACKEND_URL`: Flask backend URL for enhanced analysis
- `LOG_LEVEL`: Logging level (DEBUG, INFO, WARNING, ERROR)
- `MAX_CONCURRENT_SCANS`: Maximum concurrent scans (default: 3)

### Tool Configuration

Individual tools can be configured by editing their respective configuration files in the `config/` directory:

- `config/nmap.yaml`: Nmap configuration
- `config/nuclei.yaml`: Nuclei templates and settings  
- `config/nikto.yaml`: Nikto scanning preferences
- `config/ffuf.yaml`: FFUF wordlists and parameters

## Intelligence Engine

The server includes an advanced intelligence engine that:

### Smart Tool Selection
- Analyzes target characteristics to select optimal tools
- Considers time budget and risk tolerance
- Avoids unnecessary scans to reduce false positives

### Analysis Strategies

- **Quick Assessment**: Basic reconnaissance and vulnerability detection
- **Comprehensive**: Full security assessment with all tools
- **Web Focused**: Specialized web application testing
- **Network Focused**: Network infrastructure assessment
- **Stealth Mode**: Low-noise scanning for sensitive environments

### Risk Assessment

Automatically calculates risk scores based on:
- Vulnerability severity and exploitability
- Business impact assessment
- Compliance framework alignment
- Technical debt and configuration issues

## Integration

### Flask Backend Integration

The server can integrate with a Flask backend for:
- Enhanced vulnerability analysis
- Historical scan data
- Custom reporting and dashboards
- Integration with existing security workflows

Configure the Flask backend URL in your environment:
```bash
export FLASK_BACKEND_URL="http://localhost:5000"
```

### MCP Client Integration

Use with any MCP-compatible client:

```python
from mcp import Client

client = Client("stdio", command=["python", "-m", "src.server"])

# Perform vulnerability scan
result = await client.call_tool("vulnerability_scan", {
    "target": "https://example.com",
    "strategy": "comprehensive"
})
```

## Security Considerations

### Authorization

- Ensure proper authorization before scanning any targets
- Respect rate limits and terms of service
- Only scan systems you own or have explicit permission to test

### Data Handling

- Scan results may contain sensitive information
- Implement appropriate data retention and disposal policies
- Consider encryption for stored results

### Tool Safety

- All tools are configured with safe defaults
- Manual validation of findings is recommended
- False positive filtering is enabled by default

## Troubleshooting

### Common Issues

1. **Tools Not Found**
   - Run `.\fix_missing_tools.ps1` to install missing tools
   - Verify tools are in PATH or update tool paths in configuration

2. **Permission Errors**
   - Ensure appropriate permissions for security scanning
   - Some tools may require elevated privileges

3. **Network Timeouts**
   - Adjust timeout values in tool configurations
   - Consider network connectivity and target responsiveness

### Logging

Enable debug logging for detailed information:
```bash
export LOG_LEVEL=DEBUG
python -m src.server
```

### Validation

Check tool availability and configuration:
```bash
python -c "
from src.tools.tool_registry import ToolRegistry
registry = ToolRegistry()
print(registry.validate_registry())
"
```

## Contributing

1. Fork the repository
2. Create a feature branch
3. Add tests for new functionality
4. Ensure all tests pass
5. Submit a pull request

### Adding New Tools

To add a new security tool:

1. Create a new tool class inheriting from `BaseTool`
2. Implement required methods (`execute`, `get_description`, `get_input_schema`, `is_available`)
3. Register the tool in `ToolRegistry`
4. Add configuration and documentation

## License

This project is licensed under the MIT License - see the LICENSE file for details.

## Disclaimer

This tool is for authorized security testing only. Users are responsible for ensuring they have proper authorization before scanning any systems. The authors are not responsible for any misuse or damage caused by this software.
